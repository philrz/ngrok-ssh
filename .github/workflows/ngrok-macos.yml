name: "ngrok SSH tunnel (macOS)"

on:
  workflow_dispatch:
    inputs:
      run-on:
        description: 'macOS runner image to use'
        required: true
        default: 'macos-15'
        type: choice
        options:
        - macos-15
        - macos-15-intel
        - macos-14

jobs:
  ngrok_ssh_tunnel:
    runs-on: ${{ github.event.inputs.run-on }}
    steps:
      - uses: actions/checkout@v3
      - name: Start SSH via ngrok
        run: ./start_ngrok_tunnel.sh
        env:
          NGROK_TOKEN: ${{ secrets.NGROK_TOKEN }}
          SSH_PUBLIC_KEY: ${{ secrets.NGROK_SSH_PUBLIC_KEY }}
        shell: bash
      - name: Keep tunnel alive for 24 hours
        run: sleep 86400
        shell: bash
